---
x-volumes: &volumes
  - /etc/timezone:/etc/timezone:ro
  - /etc/localtime:/etc/localtime:ro
  - ./config/specs:/config/specs:ro
x-workdir: &default-workdir /config/specs
x-tty: &tty true

services:

  system-under-test:
    image: springcommunity/spring-petclinic:3.5.6
    container_name: system-under-test
    ports:
      - 8080:8080

  sleeper:
    image: alpine:3.22.2
    container_name: sleeper
    command: ["ash", "-c", "sleep 15"]

  k6-runner:
    image: grafana/k6:1.3.0
    container_name: k6-runner
    volumes: *volumes
    working_dir: *default-workdir
    environment:
      - TARGET_URL=http://system-under-test:8080
    command: run --no-usage-report first.js
    tty: *tty
    depends_on:
      sleeper:
        condition: service_completed_successfully
